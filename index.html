<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>調酒天地</title>
  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAb7IehvgRm-b2o_yJ3SkdQDWwjy7ugC6I",
      authDomain: "cocktail-selector-a1b46.firebaseapp.com",
      projectId: "cocktail-selector-a1b46",
      storageBucket: "cocktail-selector-a1b46.firebasestorage.app",
      messagingSenderId: "213382733661",
      appId: "1:213382733661:web:3487fa9ebbb2e0c64652b4",
      measurementId: "G-LC2T6DR3HB"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginBtn = document.getElementById('login-btn');
    const avatar = document.getElementById('user-avatar');

    loginBtn.addEventListener('click', async () => {
      const provider = new GoogleAuthProvider();
      try {
        await signInWithPopup(auth, provider);
      } catch (error) {
        alert("登入失敗: " + error.message);
      }
    });

    onAuthStateChanged(auth, user => {
      if (user) {
        loginBtn.style.display = 'none';
        avatar.src = user.photoURL;
        avatar.style.display = 'inline';
      }
    });

    // 儲存調酒表單
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelector("#page1 form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const user = auth.currentUser;
        if (!user) return alert("請先登入");

        const data = {
          userId: user.uid,
          name: e.target[0].value,
          content: e.target[1].value,
          ratio: e.target[2].value,
          taste: e.target[3].value,
          price: e.target[4].value,
          public: e.target[5].checked,
          createdAt: new Date()
        };

        try {
          await addDoc(collection(db, "cocktails"), data);
          alert("儲存成功！");
          e.target.reset();
        } catch (error) {
          alert("儲存失敗: " + error.message);
        }
      });
    });
  </script>
</head>
<body>
  <!-- 內容維持原樣 -->
</body>
</html>


